name: CI

on:
  push:
    branches:
      - feature/github-actions-heroku

jobs:
  staging-build:

    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v1

      - name: Install node packages
        run: npm install

      - name: Run test
        run: npm run test
        env:
          CI: true

      - name: Run build
        run: npm run build

      - name: Run lint
        run: npm run lint

      - name: Add Heroku remote origin
        run: git remote add heroku https://heroku:${{ secrets.HEROKU_API_KEY }}@git.heroku.com/${{ secrets.HEROKU_STAGING_APP }}.git

      - name: Deploy to Heroku
        run: git push -f origin/feature/github-actions-heroku:master
